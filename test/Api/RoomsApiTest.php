<?php
/**
 * RoomsApiTest
 * PHP version 8.1
 *
 * @category Class
 * @package  Alfaview\Client
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */

/**
 * alfaview
 *
 * ## General format information * All time fields are returned in RFC3339 format and in UTC if not mentioned otherwise.
 *
 * The version of the OpenAPI document: 2
 * Generated by: https://openapi-generator.tech
 * Generator version: 7.16.0-SNAPSHOT
 */

/**
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Please update the test case below to test the endpoint.
 */

namespace Alfaview\Client\Test\Api;

use Alfaview\Client\Alfaview;
use \Alfaview\Client\Configuration;
use \Alfaview\Client\ApiException;
use Alfaview\Client\Model\APICredentials;
use Alfaview\Client\Model\LanguageSettings;
use Alfaview\Client\Model\LanguageSettingsEdit;
use Alfaview\Client\Model\Room;
use Alfaview\Client\Model\RoomCreate;
use Alfaview\Client\Model\SubroomCreateListItem;
use \Alfaview\Client\ObjectSerializer;
use PHPUnit\Framework\TestCase;

/**
 * RoomsApiTest Class Doc Comment
 *
 * @category Class
 * @package  Alfaview\Client
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */
class RoomsApiTest extends TestCase
{
    protected Alfaview $alfaview;

    protected APICredentials $credentials;

    /**
     * Setup before running any test cases
     */
    public static function setUpBeforeClass(): void
    {
    }

    /**
     * Setup before running each test case
     */
    public function setUp(): void
    {
        $this->alfaview = new Alfaview();
        $this->alfaview->setHost(getenv('API_HOST'));

        $this->credentials = new APICredentials();
        $this->credentials->setClientId(getenv('API_CLIENT_ID'));
        $this->credentials->setKey(getenv('API_CODE'));
        $this->credentials->setCompanyId(getenv('API_COMPANY_ID'));
    }

    /**
     * Clean up after running each test case
     */
    public function tearDown(): void
    {
        $accessToken = $this->alfaview->authenticationApi->authenticateAPIKey($this->credentials);
        $response = $this->alfaview->roomsApi->listRooms($accessToken->getAccessToken());

        foreach ($response->getData() as $room) {
            if (strpos($room->getDisplayName(), 'created by php-sdk') !== false) {
                $this->alfaview->roomsApi->deleteRoom($room->getId(), $accessToken->getAccessToken());
            }
        }
    }

    /**
     * Clean up after running all test cases
     */
    public static function tearDownAfterClass(): void
    {
    }

    /**
     * Test case for createJoinLink
     *
     * Create join link.
     *
     */
    public function testCreateJoinLink()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for createPermissions
     *
     * Create permissions.
     *
     */
    public function testCreatePermissions()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for createRoom
     *
     * Create room.
     *
     */
    public function testCreateRoom()
    {
        $accessToken = $this->alfaview->authenticationApi->authenticateAPIKey($this->credentials);

        $subrooms = array(
            new SubroomCreateListItem(),
            new SubroomCreateListItem(),
            new SubroomCreateListItem(),
            new SubroomCreateListItem(),
            new SubroomCreateListItem()
        );

        $roomCreate = new RoomCreate();
        $roomCreate->setDisplayName('room created by php-sdk V2');
        $roomCreate->setSubrooms($subrooms);
        $roomCreate->setType(RoomCreate::TYPE_ROOM);
        $roomCreate->setWaitingRoomEnabled(false);

        $room = $this->alfaview->roomsApi->createRoom($roomCreate, $accessToken->getAccessToken());
        $this->assertNotEmpty($room->getId());


        $fetchedRoom = $this->alfaview->roomsApi->getRoom($room->getId(), $accessToken->getAccessToken());

        $this->assertEquals($fetchedRoom->getId(), $room->getId());

    }

    /**
     * Test case for createSubroom
     *
     * Create subroom.
     *
     */
    public function testCreateSubroom()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for deletePermissions
     *
     * Delete permissions.
     *
     */
    public function testDeletePermissions()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for deleteRoom
     *
     * Delete room.
     *
     */
    public function testDeleteRoom()
    {
        $accessToken = $this->alfaview->authenticationApi->authenticateAPIKey($this->credentials);
        $response = $this->alfaview->roomsApi->listRooms($accessToken->getAccessToken());

        foreach ($response->getData() as $room) {
            if (strpos($room->getDisplayName(), 'created by php-sdk') !== false) {
                $this->alfaview->roomsApi->deleteRoom($room->getId(), $accessToken->getAccessToken());
            }
        }
    }

    /**
     * Test case for deleteRoomFeatures
     *
     * Delete room features.
     *
     */
    public function testDeleteRoomFeatures()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for deleteSubroom
     *
     * Delete subroom.
     *
     */
    public function testDeleteSubroom()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for getRoom
     *
     * Get room.
     *
     */
    public function testGetRoom()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for getRoomFeatures
     *
     * Get room features.
     *
     */
    public function testGetRoomFeatures()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for listParticipants
     *
     * List participants.
     *
     */
    public function testListParticipants()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for listPermissionGroups
     *
     * List permission groups.
     *
     */
    public function testListPermissionGroups()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for listPermissions
     *
     * List room permissions.
     *
     */
    public function testListPermissions()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for listRoomTypes
     *
     * List room types.
     *
     */
    public function testListRoomTypes()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for listRooms
     *
     * List rooms.
     *
     */
    public function testListRooms()
    {
        $accessToken = $this->alfaview->authenticationApi->authenticateAPIKey($this->credentials);
        $rooms = $this->alfaview->roomsApi->listRooms($accessToken->getAccessToken(), Room::TYPE_ROOM);

        $this->assertIsArray($rooms->getData());
    }

    /**
     * Test case for listSubrooms
     *
     * List subrooms.
     *
     */
    public function testListSubrooms()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for updatePermissions
     *
     * Update permissions.
     *
     */
    public function testUpdatePermissions()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for updateRoom
     *
     * Update room.
     *
     */
    public function testUpdateRoom()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for updateRoomFeatures
     *
     * Update room features.
     *
     */
    public function testUpdateRoomFeatures()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for updateSubroom
     *
     * Update subroom.
     *
     */
    public function testUpdateSubroom()
    {
        // TODO: implement
        self::markTestIncomplete('Not implemented');
    }

    /**
     * Test case for listAvailableLanguages
     *
     * List Available Languages.
     *
     */
    public function testListAvailableLanguages()
    {
        $accessToken = $this->alfaview->authenticationApi->authenticateAPIKey($this->credentials);
        $resp = $this->alfaview->roomsApi->listAvailableLanguages($accessToken->getAccessToken());

        $this->assertNotEmpty($resp->getTranscription());
        $this->assertNotEmpty($resp->getTranslation());
    }

    /**
     * Test case for getLanguageSettings
     *
     * Get Language Settings.
     *
     */
    public function testGetLanguageSettings()
    {
        $accessToken = $this->alfaview->authenticationApi->authenticateAPIKey($this->credentials);

        $roomCreate = new RoomCreate();
        $roomCreate->setDisplayName('room created by php-sdk V2');
        $roomCreate->setType(RoomCreate::TYPE_ROOM);
        $roomCreate->setWaitingRoomEnabled(false);

        $room = $this->alfaview->roomsApi->createRoom($roomCreate, $accessToken->getAccessToken());
        $languageSettingsResp = $this->alfaview->roomsApi->getLanguageSettings($room->getId(), $accessToken->getAccessToken());

        $this->assertNotEmpty($languageSettingsResp->getTranscriptionType());
    }

    /**
     * Test case for updateLanguageSettings
     *
     * Update Language Settings.
     *
     */
    public function testUpdateLanguageSettings()
    {
        $accessToken = $this->alfaview->authenticationApi->authenticateAPIKey($this->credentials);

        $roomCreate = new RoomCreate();
        $roomCreate->setDisplayName('room created by php-sdk V2');
        $roomCreate->setType(RoomCreate::TYPE_ROOM);
        $roomCreate->setWaitingRoomEnabled(false);

        $room = $this->alfaview->roomsApi->createRoom($roomCreate, $accessToken->getAccessToken());

        $listAvailableLanguagesResp = $this->alfaview->roomsApi->listAvailableLanguages($accessToken->getAccessToken());

        $this->assertNotEmpty($listAvailableLanguagesResp->getTranscription());
        $this->assertNotEmpty($listAvailableLanguagesResp->getTranslation());

        $languageSettings = new LanguageSettingsEdit();
        $languageSettings->setTranscriptionEnabled(true);
        $languageSettings->setTargetTranscriptionLanguages([$listAvailableLanguagesResp->getTranscription()[0]]);
        $this->alfaview->roomsApi->updateLanguageSettings($room->getId(), $languageSettings, $accessToken->getAccessToken());
    }
}
